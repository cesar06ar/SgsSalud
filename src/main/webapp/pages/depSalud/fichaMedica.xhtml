<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      template="/WEB-INF/view/templates/glue.xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:s="http://jboss.org/seam/faces"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"      
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:glue="http://eqaula.org/jsf/facelets"
      xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon">

    <ui:composition template="/WEB-INF/view/templates/glue.xhtml">
        <f:metadata>
            <f:viewParam name="pacienteId" value="#{fichaMedicaHome.pacienteId}" />
            <f:viewParam name="fichaMedicaId" value="#{fichaMedicaHome.fichaMedicaId}" />
            <f:viewParam name="backView" value="#{fichaMedicaHome.backView}" />
        </f:metadata>

        <ui:define name="header-replace" > <!--rendered="#{identity.loggedIn and account.renderView}"-->
            <h:panelGroup  rendered="#{identity.loggedIn and account.renderView}">
                <div class="header-replace">
                    <div class="container">
                        <div class="row fl" style="margin-top: 5px;">
                            <h2>#{fichaMedicaHome.managed? messages['common.edit'] : messages['common.add']} #{messages['fichaMedica.nombre']} 
                                #{fichaMedicaHome.instance.numeroFicha}</h2>   
                        </div>
                    </div>
                </div>
            </h:panelGroup>
        </ui:define>
        <ui:define name="content" class="span20" >            
            <h:form id="form" rendered="#{identity.loggedIn and account.renderView}">
                <p:messages id="messages1" showDetail="true" autoUpdate="true" closable="true" escape="false"/>
                <p:growl id="growl" showDetail="true" sticky="true" escape="false"/>  
                <div class="columns offset7" >
                    <h:panelGrid id="buscarp" class="clearfix" columns="3" style="margin: -12px 0px -6px -20px; ">
                        <label for="buscar">#{'Buscar por'}</label>
                        <script type="text/javascript">
                            $(document).ready(function() {
                                $('#form\\:buscar').attr("placeholder", "N&ordm; de ficha, cedula");
                            });
                        </script>
                        <h:inputText id="buscar" value="#{fichaMedicaHome.parametroBusqueda}" styleClass="span5" required="true" label="" >                                                                                
                            <p:ajax process="@this" update=":form" listener="#{fichaMedicaHome.buscarPorParametro()}"/>   
                        </h:inputText>                                                                   
                        <p:commandLink id="cargarPaciente" 
                                       title="Buscar Paciente"  styleClass="btn primary" style="height: 16px;">
                            <p:graphicImage value="#{resource['/images/buscar.png']}" style="margin-top: -2px;"/>
                            <p:ajax process="@this" update=":form:infoP :form:infoFM :form:carPanel:tablaPacient" 
                                    rendered=":form:infoP :form:infoFM"  listener="#{fichaMedicaHome.buscarPorParametro()}"/>
                        </p:commandLink>
                        <p:overlayPanel id="carPanel" for="cargarPaciente" hideEffect="fade" dynamic="true">
                            <p:dataTable id="tablaPacient" value="#{fichaMedicaHome.listaPacietes}" var="paciente_">
                                <p:column headerText="#{messages['profile.dni']}">
                                    <h:outputText value="#{paciente_.cedula}" />
                                </p:column >
                                <p:column headerText="#{messages['common.surname']}">
                                    <h:outputText value="#{paciente_.apellidos}" />
                                </p:column >
                                <p:column headerText="#{messages['common.firstname']}">
                                    <h:outputText value="#{paciente_.nombres}" />
                                </p:column >                                
                                <p:column headerText="#{messages['common.edad']}">
                                    <h:outputText value="#{paciente_.edad}" />
                                </p:column >
                                <p:column headerText="Opcion">
                                    <h:link id="cargarPaciente" outcome="/pages/depSalud/fichaMedica.xhtml?faces-redirect=true" 
                                            title="cargar"  styleClass="btn primary" value="cargar">                                        
                                        <f:param name="pacienteId" value="#{paciente_.id}"></f:param>                                
                                    </h:link>
                                </p:column >
                            </p:dataTable>
                        </p:overlayPanel>  
                    </h:panelGrid>
                </div>
                <p:panel id="infoP" header="Información Personal" styleClass="clearfix">
                    <div class="row fl">
                        <div class="span2 columns " style="margin: 10px 0 0 20px;">
                            <p:graphicImage value="#{fichaMedicaHome.paciente.cargarFoto}" width="105" height="125" style="background-color: #CAD0D2; margin-bottom: -30px; margin-left: 5px; "/>
                        </div>
                    </div>
                    <div class="container-fluid">   
                        <div class="row-fluid" >
                            <div class="span7" style="margin-left: -20px;">
                                <glue:output id="nfm" name="nficha" type="text" label="#{messages['fichaMedica.numero']}" value="#{fichaMedicaHome.instance.numeroFicha}" required="true" execute="@this save" render="nfm" styleClass="xLarge" disabled="true"/>
                                <p:spacer width="400" height="3" style="background-color: #a9dba9; margin-bottom: 2px; margin-left: 45px;"/>
                                <glue:output id="fstn" name="nombres" type="text" label="#{messages['common.firstname']}" value="#{fichaMedicaHome.paciente.nombres}" required="false" execute="@this save" render="fstn" styleClass="xLarge" disabled="true"/>
                                <glue:output id="srn" name="apellidos" type="text" label="#{messages['common.surname']}" value="#{fichaMedicaHome.paciente.apellidos}" required="false" execute="@this save" render="srn" styleClass="xLarge" disabled="true"/>                                      
                                <glue:output id="genero" name="genero" type="select" label="#{messages['comun.genero']}" value="#{fichaMedicaHome.paciente.genero}" values="#{pacienteHome.listaGeneros}" converter="#{omnifaces.GenericEnumConverter}" 
                                             required="false" execute="@this save" render="genero" styleClass="xLarge" disabled="true"/>                                      
                            </div>
                            <div class="span7" align="left">                                                                
                                <h:panelGroup layout="block" class="clearfix" >
                                    <label for="fafm" >#{messages['fichaMedica.fechaApertura']}"</label>
                                    <div class="input">                                                         
                                        <p:calendar id="fafm" value="#{fichaMedicaHome.instance.fechaApertura}"  label="#{messages['fichaMedica.fechaApertura']}" 
                                                    disabled="true" pattern="dd-MMM-yyyy">                                            
                                        </p:calendar>                                                                                                      
                                        <h:graphicImage value="#{resource['success.gif']}" rendered="#{fichaMedicaHome.instance.fechaApertura != null}"
                                                        styleClass="validation-status" />                                                        
                                    </div>
                                </h:panelGroup> 
                                <p:spacer width="397" height="3" style="background-color: #a9dba9; margin-bottom: 5px;"/>
                                <ui:repeat value="#{fichaMedicaHome.paciente.findBussinesEntityAttribute('datosPersonalesPaciente')}" var="attrib" varStatus="status">
                                    <h:panelGroup layout="block" class="clearfix" rendered="#{attrib.name eq 'estadoCivil'}">
                                        <label for="#{a.name}" class="#{(not empty attrib.property.required and attrib.property.required) ? 'required' : ''}">#{attrib.property.label}#{(not empty attrib.property.required and attrib.property.required) ? '*&#160;' : ''}</label>
                                        <div class="input">                                                         
                                            <p:selectOneMenu value="#{attrib.value}" effect="fade"  converter="#{omnifaces.SelectItemsConverter}" required="#{attrib.property.required}" requiredMessage="#{attrib.property.requiredMessage}" label="#{attrib.property.label}"
                                                             rendered="#{attrib.property.type eq 'java.lang.String[]'}" disabled="#{not empty attrib}" styleClass="xLarge">  
                                                <f:selectItems value="#{ui.getValuesAsSelectItem(attrib.property.values)}" var="v" itemLabel="#{v.label}" itemValue="#{v}"/>  
                                                <p:ajax event="change" update="@parent" partialSubmit="true"/>
                                            </p:selectOneMenu>                                                                                                       
                                            <h:graphicImage value="#{resource['success.gif']}" rendered="#{attrib.value != null}"
                                                            styleClass="validation-status" />                                                        
                                        </div>
                                    </h:panelGroup>   
                                </ui:repeat>    
                                <h:panelGroup id="fnp" layout="block" class="clearfix">
                                    <label for="fnacim">#{messages['common.fecha.nacimiento']}</label>
                                    <div class="input" >
                                        <p:calendar  id="fnacim" value="#{fichaMedicaHome.paciente.fechaNacimiento}" styleClass="xLarge" required="false" label="edad" 
                                                     rendered="true" pattern="dd-MMM-yyyy" disabled="true" >
                                            <p:ajax event="dateSelect" rendered="fnp " update="@parent fnp" />  
                                        </p:calendar>      
                                        <h:graphicImage value="#{resource['success.gif']}" rendered="#{fichaMedicaHome.paciente.fechaNacimiento != null}"
                                                        styleClass="validation-status" />
                                    </div>
                                </h:panelGroup>
                                <glue:output id="edad" name="edad" type="deciamal" label="#{messages['common.edad']}" value="#{fichaMedicaHome.paciente.edad}" required="false" execute="@this save" render="edad" styleClass="xLarge" disabled="true"/>
                            </div>
                        </div>
                    </div>
                </p:panel>
                <p:separator id="separador1" style="margin-top: 0px; height:8px; margin-bottom: 0px;" styleClass="clearfix"/>

                <!--DATOS DE LA HISTORIA CLINICA-->               
                <p:tabView id="infoFM" styleClass="span16">
                    <p:tab title="#{'INF. MÉDICA'}" titletip="Información Medica General">
                        <h:panelGroup layout="block" class="clearfix">
                            <label for="gs_" class="control-label">#{messages['fichaMedica.grupoSangineo']}</label>
                            <div class="input">
                                <p:selectOneMenu id="gs_" value="#{fichaMedicaHome.instance.grupoSangineo}" effect="fade"  converter="#{omnifaces.GenericEnumConverter}" required="false" requiredMessage="false" 
                                                 rendered="true" label="#{messages['fichaMedica.grupoSanguineo']}">
                                    <f:selectItem  itemLabel = "#{messages['common.choice']}" />  
                                    <f:selectItems value="#{fichaMedicaHome.listaGruposSangineos}" var="grupoS" itemLabel="#{grupoS}" itemValue="#{grupoS}"/>                          
                                    <p:ajax event="change" update="@parent" partialSubmit="true" process="@this"/>
                                </p:selectOneMenu>  
                                <h:graphicImage value="#{resource['success.gif']}" rendered="#{fichaMedicaHome.instance.grupoSangineo != null}"
                                                styleClass="validation-status" />
                                <span class="help-inline"><br/>#{messages['fichaMedica.grupoSanguineo.lineaAyuda']} <ocp:message forId="gs_" /></span>
                            </div>
                        </h:panelGroup>
                    </p:tab>

                    <c:forEach items="#{ui.getProperties(fichaMedicaHome.instance)}" var="f" >                        
                        <p:tab title="#{f.label}" titletip="#{f.helpInline}" titleStyleClass="clearfix" 
                               disabled="#{(f.name eq 'antecedentesPersonalesFichaMedica' and account.tienePermiso('ENFERMEROS')) or (f.name eq 'antecedentesFamiliaresFichaMedica' and account.tienePermiso('ENFERMEROS'))}">
                            <c:choose>
                                <c:when test="#{f.type == 'edu.sgssalud.model.Structure'}">                                
                                    <ui:repeat value="#{fichaMedicaHome.instance.findBussinesEntityAttribute(f.name)}" var="a" varStatus="status">
                                        <c:choose>
                                            <c:when test="${f.name eq 'habitosFichaMedica'}">
                                                <h:panelGroup rendered="#{not a.property.survey}" layout="block" style="padding-left: 5px; float: left" >
                                                    <label for="#{a.name}" style="float: left" class="#{(not empty a.property.required and a.property.required) ? 'required' : ''}"><strong>#{a.property.label}#{(not empty a.property.required and a.property.required) ? '*&#160;' : '&nbsp;'}</strong></label>                                            
                                                    <div class="span4" style="padding-left: 10px; padding-top: 3px; padding-bottom: 5px;"> 
                                                        <p:selectBooleanCheckbox id="asbc" value="#{a.value}" rendered="#{a.property.type eq 'java.lang.Boolean'}" required="#{a.property.required}" >
                                                            <p:ajax event="change" update="@parent" partialSubmit="true" />                                                     
                                                        </p:selectBooleanCheckbox>   
                                                        <p:calendar value="#{a.value}" navigator="true" label="#{a.property.label}"
                                                                    rendered="#{a.property.type eq 'java.util.Date'}">
                                                            <p:ajax event="dateSelect" update="@parent" partialSubmit="true"/>
                                                        </p:calendar>                                                 
                                                        <p:inputText  value="#{a.value}" styleClass="xLarge span4" required="#{a.property.required}" label="#{a.property.label}" title="#{a.property.helpInline}"
                                                                      rendered="#{a.property.type eq 'java.lang.String'}">
                                                            <f:validator validatorId="#{not empty a.property.validator ?  a.property.validator : 'safeTextUTF8Validator'}"/>
                                                        </p:inputText>                                                                                                     
                                                        <pe:inputNumber value="#{a.value}" styleClass="xLarge span4" required="#{a.property.required}" label="#{a.property.label}" title="#{a.property.helpInline}"
                                                                        rendered="#{a.property.type eq 'java.lang.Long' or type eq 'java.lang.Double' or type eq 'java.lang.Float'}">  
                                                            <p:ajax event="blur" update="@parent" partialSubmit="true"/>
                                                        </pe:inputNumber>  
                                                        <p:selectOneMenu value="#{a.value}" effect="fade"  converter="#{omnifaces.SelectItemsConverter}" required="#{a.property.required}" requiredMessage="#{a.property.requiredMessage}" label="#{a.property.label}"
                                                                         rendered="#{a.property.type eq 'java.lang.String[]'}" >  
                                                            <f:selectItems value="#{ui.getValuesAsSelectItem(a.property.values)}" var="v" itemLabel="#{v.label}" itemValue="#{v}"/>  
                                                            <p:ajax event="change" update="@parent" partialSubmit="true"/>
                                                        </p:selectOneMenu>
                                                        <p:inputTextarea value="#{a.value}" styleClass="xLarge" required="#{a.property.required}" label="#{a.property.label}" style="width: 400px; height: 100px;" 
                                                                         rendered="#{a.property.type eq 'java.lang.MultiLineString'}" title="#{a.property.helpInline}">
                                                            <p:ajax event="blur" update="@parent" partialSubmit="true"/>
                                                        </p:inputTextarea>
                                                        <p:tooltip for="asbc" value="" showEffect="fade" hideEffect="fade">
                                                            <h:outputText escape="false" value="#{a.property.helpInline}"/>
                                                        </p:tooltip>
                                                    </div>
                                                </h:panelGroup>  
                                            </c:when>                                            
                                            <c:otherwise>
                                                <h:panelGroup rendered="#{not a.property.survey}" layout="block" >
                                                    <label for="#{a.name}" class="#{(not empty a.property.required and a.property.required) ? 'required' : ''}"><strong>#{a.property.label}#{(not empty a.property.required and a.property.required) ? '*&#160;' : '&nbsp;'}</strong></label>                                            
                                                    <div class="span1" style="padding-left: 5px; padding-top: 5px;"> 

                                                        <p:selectBooleanCheckbox id="asbc" value="#{a.value}" rendered="#{a.property.type eq 'java.lang.Boolean'}" required="#{a.property.required}">
                                                            <p:ajax event="change" update="@parent" partialSubmit="true"/>
                                                        </p:selectBooleanCheckbox>                                                        
                                                        <p:calendar value="#{a.value}" navigator="true" label="#{a.property.label}"
                                                                    rendered="#{a.property.type eq 'java.util.Date'}">
                                                            <p:ajax event="dateSelect" update="@parent" partialSubmit="true"/>
                                                        </p:calendar>                                                 
                                                        <p:inputText  value="#{a.value}" styleClass="xLarge span4" required="#{a.property.required}" label="#{a.property.label}" title="#{a.property.helpInline}"
                                                                      rendered="#{a.property.type eq 'java.lang.String'}">
                                                            <f:validator validatorId="#{not empty a.property.validator ?  a.property.validator : 'safeTextUTF8Validator'}"/>
                                                        </p:inputText>                                                                                                     
                                                        <pe:inputNumber value="#{a.value}" styleClass="xLarge span4" required="#{a.property.required}" label="#{a.property.label}" title="#{a.property.helpInline}"
                                                                        rendered="#{a.property.type eq 'java.lang.Long' or type eq 'java.lang.Double' or type eq 'java.lang.Float'}">  
                                                            <p:ajax event="blur" update="@parent" partialSubmit="true"/>
                                                        </pe:inputNumber>  
                                                        <p:selectOneMenu value="#{a.value}" effect="fade"  converter="#{omnifaces.SelectItemsConverter}" required="#{a.property.required}" requiredMessage="#{a.property.requiredMessage}" label="#{a.property.label}"
                                                                         rendered="#{a.property.type eq 'java.lang.String[]'}" >  
                                                            <f:selectItems value="#{ui.getValuesAsSelectItem(a.property.values)}" var="v" itemLabel="#{v.label}" itemValue="#{v}"/>  
                                                            <p:ajax event="change" update="@parent" partialSubmit="true"/>
                                                        </p:selectOneMenu>
                                                        <p:inputTextarea value="#{a.value}" styleClass="xLarge" required="#{a.property.required}" label="#{a.property.label}" style="width: 400px; height: 100px;" 
                                                                         rendered="#{a.property.type eq 'java.lang.MultiLineString'}" title="#{a.property.helpInline}">
                                                            <p:ajax event="blur" update="@parent" partialSubmit="true"/>
                                                        </p:inputTextarea>
                                                        <p:tooltip for="asbc" value="" showEffect="fade" hideEffect="fade">
                                                            <h:outputText escape="false" value="#{a.property.helpInline}"/>
                                                        </p:tooltip>
                                                    </div>
                                                </h:panelGroup>  
                                            </c:otherwise>
                                        </c:choose>

                                    </ui:repeat>
                                    <br/><br/>
                                    <div class="span14" style="margin-top: 15px;">                                
                                        <c:choose> 
                                            <c:when test="#{(f.name eq 'antecedentesPersonalesFichaMedica')}">                                                           
                                                <glue:output id="obap1" name="observacionAP" type="textarea" label="#{'Observación Antecedentes Familiares'}" value="#{fichaMedicaHome.instance.observacionAntecedentesPersonales}" 
                                                             required="false" execute="@this :form:save" render="obap1" styleClass="span14"/>                                                                                                
                                            </c:when>                                
                                            <c:when test="#{(f.name eq 'antecedentesFamiliaresFichaMedica')}">                                                            
                                                <glue:output id="obaf1" name="observacionAF" type="textarea" label="#{'Observación Antecedentes Familiares'}" value="#{fichaMedicaHome.instance.observacionAntecedentesFamiliares}" 
                                                             required="false" execute="@this :form:save" render="obaf1" styleClass="span14"/>                                                
                                            </c:when>
                                        </c:choose> 
                                    </div>
                                </c:when>
                            </c:choose> 
                        </p:tab>
                    </c:forEach>
                </p:tabView>

                <p:panel id="signosVitalesP" header="#{messages['signosVitales.toma']} #{messages['signosVitales.Nombre']}" toggleable="true" styleClass="span16" toggleSpeed="100" closeSpeed="0" 
                         rendered="#{fichaMedicaHome.instance.persistent and account.tienePermiso('ENFERMEROS') }">
                    <h:link value="#{messages['common.new1']} #{messages['comun.consulta']}" rendered="#{true}" outcome="/pages/depSalud/enfermeria/signosVitales" 
                            styleClass="btn success Large">
                        <h:graphicImage value="#{resource['images/sv2.png']}" style="float: left;" />
                        <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>                                
                        <f:param name="backView" value="fichaMedica"></f:param>
                    </h:link>
                    <br/>    
                    <p:dataTable id="tablaSigVit" value="#{fichaMedicaHome.listaSignosVitales}" var="signosVit_" >

                        <p:column headerText="#{messages['consultaMedica.fechaConsulta']}" style="width: 15%">
                            <p:outputLabel value="#{signosVit_.fechaActual}" >
                                <f:convertDateTime pattern="dd-MMM-yyyy"/>
                            </p:outputLabel>
                        </p:column>
                        <p:column headerText="#{messages['signosVitales.presionArt']}" style="width: 30%">
                            <h:outputText value="#{signosVit_.presionArterialSistolica}" />&nbsp;&nbsp;
                            <h:outputText value="#{signosVit_.presionArterialDiastolica}" />
                        </p:column>
                        <p:column headerText="#{messages['signosVitales.pulso']}" style="width: 20%">
                            <h:outputText value="#{signosVit_.pulso}" />                                                          
                        </p:column>
                        <p:column headerText="#{messages['signosVitales.talla']}" style="width: 20%">
                            <h:outputText value="#{signosVit_.talla}" />                                                          
                        </p:column>
                        <p:column headerText="#{messages['signosVitales.temperatura']}" style="width: 20%">
                            <h:outputText value="#{signosVit_.temperatura}" />                                                          
                        </p:column>
                        <p:column headerText="#{'Opción'}" style="width: 20%">
                            <h:link value="#{messages['common.edit']}" outcome="/pages/depSalud/enfermeria/signosVitales" >                                
                                <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>                                
                                <f:param name="signosVitalesId" value="#{signosVit_.id}"></f:param>
                                <f:param name="backView" value="fichaMedica"></f:param>
                            </h:link>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <!--Evolucion o consultas medicas-->
                <p:panel id="consultasM" header="#{'CONSULTAS MÉDICAS'}" toggleable="true" styleClass="span16" toggleSpeed="100" closeSpeed="0" 
                         rendered="#{fichaMedicaHome.instance.persistent and account.tienePermiso('MEDICOS')}">                    
                    <div class="admin-actions">
                        <h:link value="#{messages['common.add']}" rendered="#{true}" outcome="/pages/depSalud/medicina/consultaMedica" styleClass="btn success" >
                            <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>                                
                            <f:param name="backView" value="fichaMedica"></f:param>
                        </h:link>                        
                    </div> 
                    <p:dataTable id="tablaConsultasM" value="#{fichaMedicaHome.historiaClinica.consultas}" rows="10" var="consultaM_" editable="true"
                                 selection="#{fichaMedicaHome.consultaMedica}" selectionMode="single" rowKey="#{consultaM_.id}" 
                                 paginator="true">                                                   
                        <p:column headerText="Id" style="width: 7%">
                            <h:outputText value="#{consultaM_.id}"/>
                        </p:column>                            
                        <p:column headerText="#{messages['consultaMedica.fechaConsulta']}" style="width: 13%">
                            <p:outputLabel value="#{consultaM_.fechaConsulta}" style="width: 65px; margin-top: -6px;" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <h:outputText value="#{consultaM_.horaConsulta}" >
                                <f:convertDateTime pattern="HH:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{messages['consultaMedica.motivo']}" style="width: 30%">
                            <h:outputText value="#{consultaM_.motivoConsulta}" />
                        </p:column>
                        <p:column headerText="#{messages['consultaMedica.Tratamiento']}" style="width: 29%">
                            <h:outputText value="#{consultaM_.tratamiento}" />
                        </p:column>
                        <p:column headerText="#{messages['comun.estado']}"  style="width: 10%">
                            <h:outputText value="#{consultaM_.code}" title="Estado de la consulta puede ser (PENDIENTE o REALIZADA)" escape="false"/>
                        </p:column>
                        <p:column headerText="#{'Opcines'}" style="width: 20%">
                            <h:link id="button-edit" rendered="#{true}" outcome="/pages/depSalud/medicina/consultaMedica" title="#{messages['common.edit']}" 
                                    styleClass="btn success" style="width: 10px; height: 10px; float: left; margin-left: -5px;">
                                <p:graphicImage value="/resources/images/Icon_edit.gif" width="10" height="10"/>
                                <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>
                                <f:param name="consultaMedicaId" value="#{consultaM_.id}"></f:param>
                                <f:param name="backView" value="fichaMedica"></f:param>
                            </h:link>
                            <p:commandButton id="button-delete" type="button" title="#{messages['common.delete']}" 
                                             onclick="#{'deletedDlg.show()'}"  immediate="true" styleClass="btn success" 
                                             icon="ui-icon-trash" style="width: 40px; height: 23px;">                        
                                <f:setPropertyActionListener value="#{consultaM_}" target="#{fichaMedicaHome.consultaMedica}"/>
                                <p:ajax process="@this" update=":cancel-dialog" />
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <!--Evolucion o consultas medicas-->
                <p:panel id="consultasO" header="#{'CONSULTAS ODONTOLOGICAS'}" toggleable="true" styleClass="span16" toggleSpeed="100" closeSpeed="0" 
                         rendered="#{fichaMedicaHome.instance.persistent and account.tienePermiso('ODONTOLOGOS')}">                   
                    <div class="admin-actions">
                        <h:link value="#{messages['common.add']}" rendered="#{true}" outcome="/pages/depSalud/odontologia/consultaOdontologica" styleClass="btn success">
                            <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>                                
                            <f:param name="backView" value="fichaMedica"></f:param>
                        </h:link>
                        #{' '}
                        <h:link id="button-edit1" value="#{messages['common.edit']}" rendered="#{true}" outcome="/pages/depSalud/odontologia/consultaOdontologica" styleClass="btn success"
                                disabled="#{fichaMedicaHome.consultaOdont == null}" >
                            <f:param name="fichaMedicaId" value="#{fichaMedicaHome.instance.id}"></f:param>
                            <f:param name="consultaOdontId" value="#{fichaMedicaHome.consultaOdont.id}"></f:param>
                            <f:param name="backView" value="fichaMedica"></f:param>
                        </h:link>

                    </div> 
                    <p:dataTable id="tablaConsultasO" value="#{fichaMedicaHome.fichaOdontologica.consultas}" rows="10" var="consultaO_" editable="true"
                                 selection="#{fichaMedicaHome.consultaOdont}" selectionMode="single" rowKey="#{consultaO_.id}"
                                 paginator="true">                           
                        <p:ajax event="rowSelect" listener="#{fichaMedicaHome.onRowSelect1}"   
                                update=":form:button-edit1 :form:growl"/>  
                        <p:ajax event="rowUnselect" listener="#{fichaMedicaHome.onRowUnselect1}" 
                                update=":form:button-edit1 :form:growl"/>

                        <p:column headerText="Id" style="width: 7%">
                            <h:outputText value="#{consultaO_.id}"/>
                        </p:column>                            
                        <p:column headerText="#{messages['consultaMedica.fechaConsulta']}" style="width: 15%">                            
                            <p:outputLabel value="#{consultaO_.fechaConsulta}" style="width: 75px; margin-top: -6px;">
                                <f:convertDateTime pattern="dd-MMM-yyyy"/>
                            </p:outputLabel>
                            &nbsp;&nbsp;&nbsp;&nbsp; 
                            <h:outputText value="#{consultaO_.horaConsulta}">
                                <f:convertDateTime pattern="HH:mm"/>
                            </h:outputText>
                        </p:column>                                                    
                        <p:column headerText="#{messages['consultaMedica.motivo']}" style="width: 35%">
                            <h:outputText value="#{consultaO_.motivoConsulta}" styleClass="span3"/>
                        </p:column>                        
                        <p:column headerText="#{messages['tratamiento.label']}" style="width: 15%">
                            <h:outputText value="#{consultaO_.tratamientoDientes.size}" styleClass="span2"/>
                        </p:column> 
                        <p:column headerText="#{messages['comun.estado']}" style="width: 10%">
                            <h:outputText value="#{consultaO_.code}" />
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <div class="admin-actions span15" style="padding-right: 40px;">
                    <br/>
                    <p:commandButton id="save" action="#{fichaMedicaHome.guardar()}" value="#{messages['common.save']}" styleClass="btn primary offset4"
                                     immediate="true"/>
                    &nbsp;&nbsp;
                    <h:link outcome="/pages/home.xhtml?faces-redirect=true" 
                            value="#{messages['common.cancel']}" styleClass="btn primary" >                         
                    </h:link>
                </div>
                <div class="offset8" style="float: right">
                    <glue:output id="respons" name="responsable" type="text" label="Responsable" value="#{fichaMedicaHome.instance.responsable.fullName}" 
                                 required="false" execute="@this" render="edad" styleClass="xLarge" disabled="true"/>
                </div>                
            </h:form>
            <p:dialog id="cancel-dialog" header="#{messages['common.delete.confirm']}" widgetVar="deletedDlg" resizable="false" modal="true">  
                <h:form id="form-dialog-confirm-delete">
                    <h:panelGroup layout="block" style="padding:5px;">  
                        <h:outputText value="#{messages['common.delete.confirm.message']}"/>  
                    </h:panelGroup>  
                    <p:commandButton value="#{messages['common.yes']}" oncomplete="deletedDlg.hide();"                                           
                                     action="#{fichaMedicaHome.borrarConsultaMedica()}" update=":form:tablaConsultasM"                                         
                                     ajax="true" process="@this"  
                                     style="margin-top:10px;">  
                    </p:commandButton>  
                    <p:commandButton value="#{messages['common.no']}" type="button" onclick="deletedDlg.hide();"  
                                     style="margin-top:10px;"/>  
                </h:form>
            </p:dialog>
        </ui:define>
        <ui:define name="content-pre">
            <h:panelGroup  rendered="#{!account.renderView}">
                <br/><br/>
                <div class="section">
                    <h1>Accesso Denegado</h1>
                </div>

                <div class="section">
                    <p>Usted no tiene autorización para realizar la acción solicitada.</p>

                    <p>#{facesContext.externalContext.requestMap['javax.servlet.error.message']}</p>
                </div>
            </h:panelGroup>
        </ui:define>
    </ui:composition>
</html>                
